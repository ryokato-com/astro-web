---
import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';
import { marked } from 'marked';

const postsDir = './src/content/posts';

export async function getStaticPaths() {
  const postsDir = './src/content/posts';
  const files = fs.readdirSync(postsDir);
  const paths = files.map(file => {
    const fileContent = fs.readFileSync(path.join(postsDir, file), 'utf-8');
    const { data } = matter(fileContent);
    return {
      params: { slug: data.slug },
    };
  });

  return paths; // ✅ ここがポイント！
}


// 動的ページ読み込み処理
const { slug } = Astro.params;
const filePath = `./src/content/posts/${slug}.md`;
const fileContent = fs.readFileSync(filePath, 'utf-8');
const { content, data } = matter(fileContent);
const html = marked(content);
---


<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>{data.title}</title>
  </head>
  <body class="prose p-8 max-w-screen-md mx-auto">
    <h1 class="text-2xl font-bold">{data.title}</h1>
    <p class="text-sm text-gray-500">{data.date}</p>
    <div class="mt-4" set:html={html} />
  </body>
</html>

